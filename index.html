<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Crypto Candle AI</title>

<!-- Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #0b0e11;
        color: #eaecef;
    }

    #chart {
        height: 65vh;
    }

    #aiBox {
        position: fixed;
        bottom: 15px;
        right: 15px;
        width: 320px;
        background: #161a1e;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.6);
        font-size: 13px;
        animation: fadeIn 0.3s ease-in;
    }

    #aiTitle {
        font-weight: bold;
        margin-bottom: 6px;
        color: #0ecb81;
    }

    #aiText {
        white-space: pre-line;
        line-height: 1.4;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    header {
        padding: 10px;
        background: #161a1e;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    select {
        background: #0b0e11;
        color: #eaecef;
        border: 1px solid #2b3139;
        padding: 5px;
        border-radius: 5px;
    }
</style>
</head>

<body>

<header>
    <div>ðŸ“Š Crypto Candle AI</div>
    <select id="symbol">
        <option value="BTCUSDT">BTC / USDT</option>
        <option value="ETHUSDT">ETH / USDT</option>
        <option value="BNBUSDT">BNB / USDT</option>
    </select>
</header>

<div id="chart"></div>

<div id="aiBox">
    <div id="aiTitle">ðŸ¤– KI-Analyse</div>
    <div id="aiText">Warte auf erste Kerzeâ€¦</div>
</div>

<script>
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: {
        background: { color: '#0b0e11' },
        textColor: '#eaecef'
    },
    grid: {
        vertLines: { color: '#161a1e' },
        horzLines: { color: '#161a1e' }
    },
    timeScale: { borderColor: '#2b3139' },
    rightPriceScale: { borderColor: '#2b3139' }
});

const candleSeries = chart.addCandlestickSeries({
    upColor: '#0ecb81',
    downColor: '#f6465d',
    borderUpColor: '#0ecb81',
    borderDownColor: '#f6465d',
    wickUpColor: '#0ecb81',
    wickDownColor: '#f6465d'
});

let candles = [];
let lastTime = 0;

async function loadData(symbol) {
    const res = await fetch(
        `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=100`
    );
    const data = await res.json();

    candles = data.map(c => ({
        time: c[0] / 1000,
        open: +c[1],
        high: +c[2],
        low: +c[3],
        close: +c[4]
    }));

    candleSeries.setData(candles);
    lastTime = candles[candles.length - 1].time;
}

function analyzeCandle(c, p) {
    const body = Math.abs(c.close - c.open);
    const range = c.high - c.low;
    const upShadow = c.high - Math.max(c.open, c.close);
    const lowShadow = Math.min(c.open, c.close) - c.low;
    const isBull = c.close > c.open;

    let text = '';

    if (body <= range * 0.1) {
        text += 'ðŸŸ¡ Doji:\nDer Markt ist unentschlossen. KÃ¤ufer und VerkÃ¤ufer halten sich die Waage.\n\n';
    }

    if (lowShadow > body * 2 && isBull) {
        text += 'ðŸŸ¢ Hammer:\nStarker Kaufdruck von unten â€“ mÃ¶gliche Bodenbildung.\n\n';
    }

    if (upShadow > body * 2 && !isBull) {
        text += 'ðŸ”´ Shooting Star:\nVerkÃ¤ufer drÃ¼cken den Preis â€“ mÃ¶gliches Top.\n\n';
    }

    if (p) {
        if (!p || !p.open) return text;

        if (p.close < p.open && isBull &&
            c.close > p.open && c.open < p.close) {
            text += 'ðŸš€ Bullish Engulfing:\nStarker Umschwung nach oben â€“ KÃ¤ufer Ã¼bernehmen die Kontrolle.\n\n';
        }

        if (p.close > p.open && !isBull &&
            c.open > p.close && c.close < p.open) {
            text += 'âš ï¸ Bearish Engulfing:\nStarker Verkaufsdruck â€“ mÃ¶gliche Trendwende nach unten.\n\n';
        }
    }

    if (!text) {
        text = 'â„¹ï¸ Normale Kerze:\nKeine besonderen Muster erkannt.';
    }

    return text;
}

async function updateLoop() {
    const symbol = document.getElementById('symbol').value;
    const res = await fetch(
        `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=2`
    );
    const data = await res.json();

    const last = {
        time: data[1][0] / 1000,
        open: +data[1][1],
        high: +data[1][2],
        low: +data[1][3],
        close: +data[1][4]
    };

    if (last.time !== lastTime) {
        candles.push(last);
        candleSeries.update(last);

        const prev = candles[candles.length - 2];
        const analysis = analyzeCandle(last, prev);

        document.getElementById('aiText').textContent = analysis;
        lastTime = last.time;
    }
}

document.getElementById('symbol').addEventListener('change', () => {
    loadData(document.getElementById('symbol').value);
});

loadData('BTCUSDT');
setInterval(updateLoop, 5000);
</script>

</body>
</html>
